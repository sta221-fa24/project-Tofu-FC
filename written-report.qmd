---
title: "Mushroom Edibility Analysis"
author: "Tofu-FC - Huiwen Wang, Rocky Zhang, Darrick Zhang"
date: "10,28,24"
format: pdf
execute: 
  warning: false
  message: false
  echo: false
editor: visual
bibliography: references.bib
---

```{r}
#| label: load packages and data

library(tidyverse)
library(tidymodels)
library(dbplyr)
library(knitr)
library(GGally)
library(gridExtra)
# add other packages as needed

mushrooms <- read.csv2("data/mushrooms_dataset.csv")
```

## Introduction

### Project Motivation / Background:

Mushrooms are vital to the general wellness of the ecosystem, decomposing and recycling the nutrients in the soil. Mushrooms also provide a valuable food source full of nutrients for human beings and other important organisms. However, some mushroom species can also be poisonous and harmful.

The importance of this research has been highlighted in a multitude of studies. Take this quote, for example:

> The ingestion of wild and potentially toxic mushrooms is common in the United States, with poison centers logging cases in the National Poison Data System (NPDS) for over 30 years. From 1999 to 2016, there were 133,700 reported cases of mushroom exposure, mostly unintentional and involving children under six years old. While the majority of cases resulted in no or minor harm, there were 704 instances of major harm and 52 fatalities, primarily due to cyclopeptide-producing mushrooms ingested unintentionally by older adults. Misidentification of edible mushroom species is a common cause of poisoning and may be preventable through education [@brandenburgward2018].

As shown by studies and other similar studies, accurate classification of mushrooms is crucial for preventing poisoning incidents. Many toxic mushroom species closely resemble edible varieties, making it easy for foragers to misidentify them. Thus, our research will focus on what physical features and environmental factors of mushrooms humans can use to identify toxic/poisonous mushrooms in the wild. By conducting a research study on how to distinguish between safe and dangerous species, we can mitigate the incidence of mushroom poisoning and ensure safer foraging practices.

### Research Question:

What environmental factors and/or physical features of mushrooms indicate that a wild mushroom is poisonous?

### Hypothesis:

Mushrooms in the wild with obvious physical features like white gills, white rings, red caps, or red stems tend to be poisonous. These obvious physical traits are more likely to be spotted by animals, which would provide an evolutionary disadvantage unless they contain certain self-defense mechanisms, such as poison or toxins. Additionally, the habitat and season in which mushrooms are planted and grow may also affect whether they're poisonous. Different temperatures, humidity, and light can affect the production of toxins, which may also affect the edibility of mushrooms.

### Data Description:

The dataset we used can be found here: [Mushroom Dataset](https://www.kaggle.com/datasets/uciml/mushroom-classification/data)

The data was curated on April 26, 1987, and submitted to the UCI by the National Audubon Society Field Guide. The National Audubon Society conducted extensive field research throughout North America, recording their observations on various aspects of mushrooms. Their research incorporate a wide range of physical characteristics, including size, shape, color, and texture of the mushrooms. Additionally, they documented environmental factors such as the type of habitat and seasonal variations. Importantly, the study also focused on the toxicity of the mushrooms, noting which species were poisonous. This comprehensive dataset provides valuable insights into the relationship between mushrooms and their environments, contributing significantly to the understanding of the factors influencing mushroom toxicity.

Our response variable is `class`, which is a qualitative variable labeled "e" for edible or "p" for poisonous.

Key quantitative predictor variables include `stem.height` and `stem.width`, the height (cm) and width (cm) of the stem of the mushroom. We are also interested in `cap.diameter`, the diameter of the mushroom cap (cm).

Key qualitative predictor variables include `cap.shape`, the shape of the mushroom cap; `gill.color`, the color of the fungi gills, `stem.color`, the color of the mushroom stem; `habitat`, the habitat that the mushroom is grown/found; and `season`, the season that the mushroom is grown/found. The possible categories these variables can be take can be found in our **data dictionary** [here](https://github.com/sta221-fa24/project-Tofu-FC/blob/main/data/README.md).

## Exploratory Data Analysis

```{r}
#| label: check rows

# # Count the number of rows with at least one missing value
# num_missing_rows <- sum(rowSums(is.na(mushrooms)) > 0)
# cat("Number of rows with at least one missing value:", num_missing_rows, "\n")
```

```{r}
#| label: univariate response variable

# EDA Response (Categorical) Variable
ggplot(mushrooms, aes(x = class)) +
  geom_bar() +
  labs(
    title = "Distribution of Edibility/Classes of Mushrooms",
    x = "Class"
  ) +
  theme_minimal()

# Summary Statistics
mushrooms |>
  group_by(class) |>
  summarise(
    count = n(),
    percentage = (count / nrow(mushrooms)) * 100
  ) |> kable(digits=3)
```

Looking at the overall distribution of our response variable `class`, most of the mushrooms in our dataset seem to be poisonous ("p"). 33888 of the observations, or 55.5% of them are labeled poisonous, as opposed to 27181 (44.5%) of them as edible.

```{r}
#| label: data manipulation, multicolinearity

# Make Quantitative data numerical
mushrooms$cap.diameter <- as.numeric(mushrooms$cap.diameter)
mushrooms$stem.height <- as.numeric(mushrooms$stem.height)
mushrooms$stem.width <- as.numeric(mushrooms$stem.width)

mushrooms |>
  select(cap.diameter, stem.height, stem.width) |>
  ggpairs()

# final predictors <- c("cap.diameter", "cap.shape", "gill.color",
#                 "stem.color", "habitat", "season")
# response_var <- "class"
```

We were first interested in seeing the relationship between our continuous, quantitative variables. While not totally linear, with correlations of $0.423$ and $0.436$, they graphs seem to be somewhat linear, with some redundancy in their information. Thus, for the rest of the EDA we will focus mainly on visualizing cap.diameter. We may consider adding them back for the final model, but were more interested in seeing some of the EDA with the categorical variables.

```{r}
#| label: univariate predictors

p1 <- ggplot(mushrooms, aes(x = cap.diameter)) +
    geom_histogram() +
    labs(title = "Cap diameter",
         x="Cap diameter")
p2 <- ggplot(mushrooms, aes(x = cap.shape)) +
    geom_bar() +
    labs(title = "Cap shape",
         x="Cap shape")
p3 <- ggplot(mushrooms, aes(x = gill.color)) +
    geom_bar() +
    labs(title = "Gill color",
         x="Gill color")
p4 <- ggplot(mushrooms, aes(x = stem.color)) +
    geom_bar() +
    labs(title = "Stem color",
         x="Stem color")
p5 <- ggplot(mushrooms, aes(x = habitat)) +
    geom_bar() +
    labs(title = "Habitat",
         x="Habitat")
p6 <- ggplot(mushrooms, aes(x = season)) +
    geom_bar() +
    labs(title = "Season",
         x="Season")
grid.arrange(p1,p2,p3,p4,p5,p6)
```

To visualize the distribution of some of our predictor variables, we use a histogram for our continuous variable `cap.diameter` and bar graphs for our categorical variables. The distribution of cap diameter seems to be unimodal, skewed right. From the qualitative variables, there appears to be more common physical and environmental characteristics. For cap shape, flat and convex tends to be the most common; for stem root (originally included) the most common was "missing data" (which likely suggests that this was a variable to remove); for gill color the most common was white, yellow, and brown; for stem color the most common is white, yellow, and brown; for habitat, woods is the most common; for season, autumn and summer tends to be the most common.

```{r}
#| label: bivariate EDA
g1 <- ggplot(mushrooms, aes(x = cap.diameter, color = class)) +
    geom_boxplot() +
    theme(legend.title = element_blank()) +
    labs(title = "Response vs cap diameter",
         x = "Cap diameter")
g2 <- ggplot(mushrooms, aes(x = cap.shape, fill = class)) +
    geom_bar(position = "dodge") +
    theme(legend.title = element_blank()) +
    labs(title = "Response vs cap shape",
         x = "Cap shape")
g3 <- ggplot(mushrooms, aes(x = gill.color, fill = class)) +
    geom_bar(position = "dodge") +
    theme(legend.title = element_blank()) +
    labs(title = "Response vs gill color",
         x = "Gill color")
# g3 <- ggplot(mushrooms, aes(x = stem.root, fill = class)) +
#     geom_bar(position = "dodge") +
#     labs(title = "Response vs stem root")
g4 <- ggplot(mushrooms, aes(x = stem.color, fill = class)) +
    geom_bar(position = "dodge") +
    theme(legend.title = element_blank()) +
    labs(title = "Response vs stem color",
         x ="Stem color")
g5 <- ggplot(mushrooms, aes(x = habitat, fill = class)) +
    geom_bar(position = "dodge") +
    theme(legend.title = element_blank()) +
    labs(title = "Response vs habitat",
         x = "Habitat")
g6 <- ggplot(mushrooms, aes(x = season, fill = class)) +
    geom_bar(position = "dodge") +
    theme(legend.title = element_blank()) +
    labs(title = "Response vs season",
         x = "Season")

grid.arrange(g1,g2,g3,g4,g5,g6)
```

The bivariate exploratory data analysis also shows some interesting findings for predictors. In particular, categories that have a disparity between the two different classes could offer potential modeling power in classification of the classes (toxicity). Larger, more extreme cap diameter is often linked to edibility. Cap shape of convex, bell, and others is more likely to be poisonous/toxic than edible. We also see that gill color of brown and yellow tends to be poisonous. For stem color, yellow and brown tends to be more poisonous than not. And lastly the habitat of woods and the season of autumn and summer also observes a similar observation.

```{r}
#| label: analysis of interaction

ggplot(mushrooms, aes(x = habitat, fill = class)) +
  geom_bar(position = "fill") + 
  facet_wrap(~ season) +
  labs(title = "Edibility Distribution by Habitat and Season",
       x = "Habitat",
       y = "Proportion of Edibility") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplot(mushrooms, aes(x = cap.color, y = cap.shape, fill = class)) +
  geom_tile() +
  labs(title = "Cap Color and Shape Combinations by Edibility",
       x = "Cap Color",
       y = "Cap Shape") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

We believe that these predictors may have potential interactive effects that could help us with our model to predict edibility of mushrooms due to the fact that certain more specific characteristics tends to be poisonous.

**Habitat × Season**: Our EDA reveals that mushrooms in certain habitats might only be edible during specific seasons.

**Cap color × Cap shape**: Additionally, some combinations of cap color and shape may signal edibility more strongly than either feature alone.

```{r}
#| label: multivariate EDA
ggplot(mushrooms, aes(y = stem.height, x = stem.width, color = class)) +
  geom_point() +
  labs(
    title = "Distribution of Stem Height vs. Stem Width Among
    Different Edibility Classes",
    y = "Stem Height (cm)",
    x = "Stem Width (cm)",
    color = "Class (Edibile or Not)"
  ) +
  theme_minimal()
```
Finally, we look at multivariate data analysis including 2 predictors and our response variable. While the distribution of stem width and stem height seemed to be the same as cap diameter, and there may be some potential multicolinearity, we are still interested in visualizing their effect on the edibility of the mushroom. Here, we visualize the effect of both stem width and stem height on the response variable, `class`. Interestingly, it seems like mushrooms with either high stem width or stem height seem to be edible.

## References
