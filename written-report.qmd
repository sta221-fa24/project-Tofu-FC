---
title: "Mushroom Edibility Analysis"
author: "Tofu-FC - Huiwen Wang, Rocky Zhang, Darrick Zhang"
date: "10,28,24"
format: pdf
execute: 
  warning: false
  message: false
  echo: false
editor: visual
bibliography: references.bib
---

```{r}
#| label: load packages and data

library(tidyverse)
library(tidymodels)
library(dbplyr)
library(knitr)
library(gridExtra)
# add other packages as needed

mushrooms <- read.csv2("data/mushrooms_dataset.csv")
```

## Introduction

### Project Motivation / Background:

Mushrooms are vital to the general wellness of the ecosystem, decomposing and recycling the nutrients in the soil. Mushrooms also provide a valuable food source full of nutrients for human beings and other important organisms. However, some mushroom species can also be poisonous and harmful.

The importance of this research has been highlighted in a multitude of studies. Take this quote, for example:

> The ingestion of wild and potentially toxic mushrooms is common in the United States, with poison centers logging cases in the National Poison Data System (NPDS) for over 30 years. From 1999 to 2016, there were 133,700 reported cases of mushroom exposure, mostly unintentional and involving children under six years old. While the majority of cases resulted in no or minor harm, there were 704 instances of major harm and 52 fatalities, primarily due to cyclopeptide-producing mushrooms ingested unintentionally by older adults. Misidentification of edible mushroom species is a common cause of poisoning and may be preventable through education [@brandenburgward2018].

As shown by studies and other similar studies, accurate classification of mushrooms is crucial for preventing poisoning incidents. Many toxic mushroom species closely resemble edible varieties, making it easy for foragers to misidentify them. Thus, our research will focus on what physical features and environmental factors of mushrooms humans can use to identify toxic/poisonous mushrooms in the wild. By conducting a research study on how to distinguish between safe and dangerous species, we can mitigate the incidence of mushroom poisoning and ensure safer foraging practices.

### Research Question:

With this in mind, we are interested to see whether there are any environmental factors and/or physical features of mushrooms that can help curious human avoid poisonous mushrooms that may grow in their yard or in the wilderness.

### Hypotheses:

1.  Mushrooms in the wild with obvious physical features like white gills, white rings, red caps, or red stems tend to be poisonous. We want to explore this hypothesis because mushrooms with obvious physical traits are more likely to be spotted by animals, which would provide an evolutionary disadvantage unless they contain certain self-defense mechanisms, such as poison or toxins.

2.  The habitat and season of the mushrooms would likely affect whether they're poisonous. We form this hypothesis because in specific habitats, mushrooms might face intense competition for resources such as nutrients, light, or space. Producing toxins can give them a competitive edge by inhibiting the growth of other fungi or microorganisms. In addition, the growing season can influence the chemical composition of mushrooms. Different temperature, humidity, and light during various seasons can affect the production of secondary metabolites, including toxins. For instance, some mushrooms might produce more toxins during wet seasons to fend off increased microbial activity.

### Data Description:

The dataset we used can be found here: [Mushroom Dataset](https://www.kaggle.com/datasets/uciml/mushroom-classification/data)

The data was curated on April 26, 1987, and submitted to the UCI by the National Audubon Society Field Guide. The National Audubon Society conducted extensive field research throughout North America, recording their observations on various aspects of mushrooms. Their research incorporate a wide range of physical characteristics, including size, shape, color, and texture of the mushrooms. Additionally, they documented environmental factors such as the type of habitat and seasonal variations. Importantly, the study also focused on the toxicity of the mushrooms, noting which species were poisonous. This comprehensive dataset provides valuable insights into the relationship between mushrooms and their environments, contributing significantly to the understanding of the factors influencing mushroom toxicity.

The dataset includes a lot of different characteristics and predictor variables, but many are irrelevant to our research question or induce multicollinearity in our models (for more info please visit the dataset website above). The predictor variables of interest and their description can be found below:

Stem height and width, height or width in cm of the stem of the mushroom, both are quantitative variables of initial interest, but were remvoed as they were correlated to cap diameter (visualized with ggpairs).

Cap diameter, diameter of the cap of the mushroom in cm, it is a quantitative variable that could help with physical identification.

Cap shape, shape of the cap of the mushroom, it is a qualitative variable that may help in the physical identification of edibility.

Type of stem root and color, physical descriptions of the stem representing a qualitative variable of interest.

Ring type, qualitative variable representing the physical appearance of the ring (typically on the upper part of the stem) of a mushroom.

Habitat and season, qualitative variables representing the habitat and season in which that mushroom is grown and found. These variables are used for environmental predictors for edibility.

Our response variable is class, which is a qualitative variable of two levels representing the mushroom edibility.

## Exploratory Data Analysis

```{r}
#| label: univariate predictor distribution

predictors <- c("cap.diameter", "cap.shape", "stem.root",
                "stem.color", "ring.type", "habitat", "season")
response_var <- "class"

# Make Quantitative data numerical
mushrooms$cap.diameter <- as.numeric(mushrooms$cap.diameter)
mushrooms$stem.height <- as.numeric(mushrooms$stem.height)
mushrooms$stem.width <- as.numeric(mushrooms$stem.width)

p1 <- ggplot(mushrooms, aes(x = cap.diameter)) +
    geom_histogram() +
    labs(title = "Cap diameter")
p2 <- ggplot(mushrooms, aes(x = cap.shape)) +
    geom_bar() +
    labs(title = "Cap shape")
p3 <- ggplot(mushrooms, aes(x = stem.root)) +
    geom_bar() +
    labs(title = "Stem root")
p4 <- ggplot(mushrooms, aes(x = stem.color)) +
    geom_bar() +
    labs(title = "Stem color")
p5 <- ggplot(mushrooms, aes(x = ring.type)) +
    geom_bar() +
    labs(title = "Ring type")
p6 <- ggplot(mushrooms, aes(x = habitat)) +
    geom_bar() +
    labs(title = "Habitat")
p7 <- ggplot(mushrooms, aes(x = season)) +
    geom_bar() +
    labs(title = "Season")
grid.arrange(p1,p2,p3,p4,p6,p7)
```

```{r}
#| label: bivariate EDA
# g1 <- ggplot(mushrooms, aes(x = cap.diameter, color = class)) +
#     labs(title = "Response vs cap diameter")
g2 <- ggplot(mushrooms, aes(x = cap.shape, fill = class)) +
    geom_bar(position = "dodge") +
    labs(title = "Response vs cap shape")
g3 <- ggplot(mushrooms, aes(x = stem.root, fill = class)) +
    geom_bar(position = "dodge") +
    labs(title = "Response vs stem root")
g4 <- ggplot(mushrooms, aes(x = stem.color, fill = class)) +
    geom_bar(position = "dodge") +
    labs(title = "Response vs stem color")
g5 <- ggplot(mushrooms, aes(x = ring.type, fill = class)) +
    geom_bar(position = "dodge") +
    labs(title = "Response vs ring type")
g6 <- ggplot(mushrooms, aes(x = habitat, fill = class)) +
    geom_bar(position = "dodge") +
    labs(title = "Response vs habitat")
g7 <- ggplot(mushrooms, aes(x = season, fill = class)) +
    geom_bar(position = "dodge") +
    labs(title = "Response vs season")

grid.arrange(g2,g3,g4,g6,g7)
```

```{r}
#| label: distribution of predictors


```

```{r}
# Count the number of rows with at least one missing value
num_missing_rows <- sum(rowSums(is.na(mushrooms)) > 0)
cat("Number of rows with at least one missing value:", num_missing_rows, "\n")

# Make Quantitative data numerical
mushrooms$cap.diameter <- as.numeric(mushrooms$cap.diameter)
mushrooms$stem.height <- as.numeric(mushrooms$stem.height)
mushrooms$stem.width <- as.numeric(mushrooms$stem.width)

# EDA Response (Categorical) Variable
ggplot(mushrooms, aes(x = class)) +
  geom_bar() +
  labs(
    title = "Distribution of Edibility/Classes of Mushrooms",
    x = "Class"
  ) +
  theme_minimal()

# Summary Statistics
mushrooms |>
  group_by(class) |>
  summarise(
    count = n(),
    percentage = (count / nrow(mushrooms)) * 100
  ) |> kable(digits=3)

# EDA Hypothesis 1
ggplot(mushrooms, aes(y = class)) +
  geom_bar(aes(fill = gill.color,
               color = gill.color,
               alpha = 0.3)) +
  labs(
    title = "Distribution of Edibility vs. Gill Color",
    x = "Count",
    y = "Class (Edibile or Not)",
    fill = "Gill Color"
  ) +
  theme_minimal() + 
  guides(fill = "legend", 
         color = "none",
         alpha = "none")

ggplot(mushrooms, aes(y = stem.height, x = stem.width, color = class)) +
  geom_point() +
  labs(
    title = "Distribution of Stem Height vs. Stem Width Among
    Different Edibility Classes",
    y = "Stem Height (cm)",
    x = "Stem Width (cm)",
    color = "Class (Edibile or Not)"
  ) +
  theme_minimal()

ggplot(mushrooms, aes(y = class, x = cap.diameter, color = ring.type)) +
  geom_boxplot() +
  labs(
    title = "Distribution of Edibility vs. Cap Diameter Among
    Different Ring Types",
    x = "Cap Diameter (cm)",
    y = "Class (Edibile or Not)",
    color = "Ring Type"
  ) +
  theme_minimal()

# EDA Hypothesis 2

ggplot(mushrooms, aes(y = habitat, x = season, color = class)) +
  geom_boxplot() +
  #facet_wrap(~season) +
  labs(
    title = "Distribution of Edibility in Comparison 
    to Season and Habitat",
    x = "Season",
    y = "Habitat Code",
    color = "Class (Edibile or Not)"
  ) +
  theme_minimal()
```

## Data dictionary

The data dictionary can be found [here](https://github.com/sta221-fa24/project-Tofu-FC/blob/main/data/README.md)

## References
